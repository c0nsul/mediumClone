import React, {useContext, useEffect, useState} from "react"
import {Link} from "react-router-dom"
import {CurrentUserContext} from 'contexts/currentUser'
import useFetch from 'hooks/useFetch'



const CommentsFeed = ({comments, articleSlug}) => {
    const [currentUserState] = useContext(CurrentUserContext)
    const [apiUrl, setApiUrl] = useState(null)
    const [{response}, doDeleteComment] = useFetch(apiUrl)



    const handleDeleteComment = (event, id, index) => {
        event.preventDefault()
        const newUrl = `/articles/${articleSlug}/comments/${id}`
        setApiUrl(newUrl)

        doDeleteComment({
            method: 'delete'
        })

        comments.splice(index, 1);
    }



    useEffect(() => {

    },[handleDeleteComment])

    return (
        <div className="col-xs-12 col-md-12 offset-md-2">
            {comments.map((comment, index) => (
                <div className="article-preview" key={index} >

                    <div className="card">
                        <div className="card-block">
                            <div className="card-text">
                                {comment.body}
                            </div>
                        </div>
                        <div className="card-footer">
                            <Link className="comment-author" to={`/profiles/${comment.author.username}`}>
                                <img className="comment-author-img" src={comment.author.image} alt=""/>
                            </Link>
                            &nbsp;
                            <Link className="comment-author" to={`/profiles/${comment.author.username}`}>
                                {comment.author.username}
                            </Link>
                            <div className="date-posted">{comment.createdAt}</div>

                            {currentUserState.isLoggedIn && comment.author.username === currentUserState.currentUser.username
                            && (
                                <button
                                    className="mod-options"
                                    onClick={(e) =>  handleDeleteComment(e, comment.id, index)}
                                >
                                    <i className="ion-trash-a"></i>&nbsp;
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            ))}
        </div>
    )
}

export default CommentsFeed
